# Thymeleaf Example Project - Employee CRUD

## JPA Project Setup
```
src/
├── main/
│   └── java/
|       ├── Application.java
|       ├── controller/
|       |   └── EmployeeController.java
|       ├── dao/
|       |   └── EmployeeRepository.java
|       ├── service/
|       |   ├── EmployeeService.java
|       |   └── EmployeeServiceImpl.java
|       └── entity/
|           └── Employee.java
└── resources/
    |-- static.css/
    |     └── index.html
    |-- templates/
    |     └── employee-form.html
    |     └── list-employees.html
    └── application.properties
```

## DAO
### EmployeeRepository (EmployeeRepository.java)
```
package com.luv2code.springboot.thymeleafdemo.dao;

import com.luv2code.springboot.thymeleafdemo.entity.Employee;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface EmployeeRepository extends JpaRepository<Employee, Integer> {

    // that's it ... no need to write any code LOL!

    // add a method to sort by last name
    // generated by JPA
    // UDEMY Course: Spring Boot 3: Learn Spring 6, Spring Core, Spring REST, Spring MVC, Spring Security, Thymeleaf, JPA, Hibernate, MySQL - Chapter 227
    public List<Employee> findAllByOrderByLastNameAsc();
}
```

## Service
### EmployeeService (EmployeeService.java)
```
package com.luv2code.springboot.thymeleafdemo.service;

import com.luv2code.springboot.thymeleafdemo.entity.Employee;

import java.util.List;

public interface EmployeeService {

    List<Employee> findAll();

    Employee findById(int theId);

    Employee save(Employee theEmployee);

    void deleteById(int theId);

}
```

### EmployeeServiceImpl (EmployeeServiceImpl.java)
```
package com.luv2code.springboot.thymeleafdemo.service;

import com.luv2code.springboot.thymeleafdemo.dao.EmployeeRepository;
import com.luv2code.springboot.thymeleafdemo.entity.Employee;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
public class EmployeeServiceImpl implements EmployeeService {

    private EmployeeRepository employeeRepository;

    @Autowired
    public EmployeeServiceImpl(EmployeeRepository theEmployeeRepository) {
        employeeRepository = theEmployeeRepository;
    }

    @Override
    public List<Employee> findAll() {
        return employeeRepository.findAllByOrderByLastNameAsc();
    }

    @Override
    public Employee findById(int theId) {
        Optional<Employee> result = employeeRepository.findById(theId);

        Employee theEmployee = null;

        if (result.isPresent()) {
            theEmployee = result.get();
        }
        else {
            // we didn't find the employee
            throw new RuntimeException("Did not find employee id - " + theId);
        }

        return theEmployee;
    }

    @Override
    public Employee save(Employee theEmployee) {
        return employeeRepository.save(theEmployee);
    }

    @Override
    public void deleteById(int theId) {
        employeeRepository.deleteById(theId);
    }
}
```

## Entity
### Employee (Employee.java)
```
package com.luv2code.springboot.thymeleafdemo.entity;

import jakarta.persistence.*;

@Entity
@Table(name="employee")
public class Employee {

    // define fields
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name="id")
    private int id;

    @Column(name="first_name")
    private String firstName;

    @Column(name="last_name")
    private String lastName;

    @Column(name="email")
    private String email;


    // define constructors
    public Employee() {

    }

    public Employee(String firstName, String lastName, String email) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.email = email;
    }

    // define getter/setter

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    // define toString
    @Override
    public String toString() {
        return "Employee{" +
                "id=" + id +
                ", firstName='" + firstName + '\'' +
                ", lastName='" + lastName + '\'' +
                ", email='" + email + '\'' +
                '}';
    }
}
```

## Rest Controller
### Employee Controller (EmployeeController.java)
```
package com.luv2code.springboot.thymeleafdemo.controller;

import com.luv2code.springboot.thymeleafdemo.entity.Employee;
import com.luv2code.springboot.thymeleafdemo.service.EmployeeService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
@RequestMapping("/employees")
public class EmployeeController {
    private EmployeeService employeeService;

    public EmployeeController(EmployeeService theEmployeeService) {
        this.employeeService = theEmployeeService;
    }

    // add mapping for '/list'
    @GetMapping("/list")
    public String listEmployees(Model theModel) {
        // get the employees from the db
        List<Employee> theEmployees = employeeService.findAll();

        // add to the spring model
        theModel.addAttribute("employees", theEmployees);

        return "employees/list-employees";
    }

    @GetMapping("/showFormforAdd")
    public String showFormforAdd(Model theModel) {
        Employee theEmployee = new Employee();

        theModel.addAttribute("employee", theEmployee);
        return "employees/employee-form";
    }

    @GetMapping("/showFormForUpdate")
    public String showFormForUpdate(@RequestParam("employeeId") int theId, Model theModel) {
        // set the employee from the service
        Employee theEmployee = employeeService.findById(theId);

        // set employ as a mpdel attribute to populate the form
        theModel.addAttribute("employee", theEmployee);

        // send over to our form

        return "employees/employee-form";
    }

    @PostMapping("/save")
    public String saveEmployee(@ModelAttribute("employee") Employee theEmployee) {
        // save the employee
        employeeService.save(theEmployee);

        // use redirect
        return "redirect:/employees/list";
    }

    @GetMapping("/delete")
    public String delete(@RequestParam("employeeId") int theId) {
        // delete the employee
        employeeService.deleteById(theId);

        // redirect to the /employee/list
        return "redirect:/employees/list";
    }
}
```

## Templates
### Employee Form (employee-form.haml)
```
<!DOCTYPE html>
<html lang="en" xmlns:th="http://wwww.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Save Employee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h3>Employee Directory</h3>
        <br>

        <p class="h4 mb-4">Save Employee</p>

        <form action="#"    th:action="@{/employees/save}"
                            th:object="${employee}" method="POST">

            <!-- add hidden form field -->
            <input type="hidden" th:field="*{id}">
            <input type="text" class="form-control mb-4 w-25" th:field="*{firstName}" placeholder="First name">
            <input type="text" class="form-control mb-4 w-25" th:field="*{lastName}" placeholder="Last name">
            <input type="text" class="form-control mb-4 w-25" th:field="*{email}" placeholder="Email">
            <button type="submit" class="btn btn-info col-2">Save</button>
        </form>
        <a th:href="@{/employees/list}">Back to Employees List</a>
    </div>

</body>
```

## Employee List (list-employee.haml)

```
<!DOCTYPE html>
<html lang="en" xmlns:th="http://wwww.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Employee Directory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
<!--
<h1>Hello, world!</h1>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
-->



<div class="container">
    <h3>Employee Directory</h3>

    <!-- Add Employee Button -->
    <a th:href="@{/employees/showFormforAdd}"
        class="btn btn-primary btn-sm mb-3">
        Add Employee
    </a>

        <table class="table table-bordered table-striped">
            <thead class="table-dark">
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Action</th>
            <tbody>
                <tr th:each="tempEmployee : ${employees}">
                    <td th:text="${tempEmployee.firstName}" />
                    <td th:text="${tempEmployee.lastName}" />
                    <td th:text="${tempEmployee.email}" />
                    <td>
                        <a th:href="@{/employees/showFormForUpdate(employeeId=${tempEmployee.id})}"
                            class="btn btn-info btn-sm">
                            Update
                        </a>

                        <!-- add "delete bottom/line -->
                        <a th:href="@{/employees/delete(employeeId=${tempEmployee.id})}"
                            class="btn btn-danger btn-sm"
                            onclick="if (!(confirm('Are you sure you want to delete this employee?'))) return false">
                            Delete
                        </a>
                    </td>
                </tr>
            </tbody>

            </tr>
            </thead>
        </table>
</body>
</html><
```

## Static
### Static (index.html)
```
<meta http-equiv="refresh" content="0; URL='employees/list"/>
```
